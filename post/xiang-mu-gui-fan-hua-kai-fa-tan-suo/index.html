<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>项目规范化开发探索 - 常名斋</title>
<link rel="shortcut icon" href="https://conceal.name/favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://conceal.name/media/css/tailwind.css">
<link rel="stylesheet" href="https://conceal.name/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="项目规范化开发探索 - 常名斋 - Atom Feed" href="https://conceal.name/atom.xml">


  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-100208259-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-100208259-1');
  </script>
    

  <meta name="description" content="前因
这次在fcc2018前端大会上，听到了余澈前辈的《开源项目维护》分享，深有收获.所以站在前人的肩膀上探索探索
痛点
现在前端项目开发，主要是由代码、依赖库、文档、changelog、测试文件等等几部分组成。但是由于前端开发的不规范，大..." />
  <meta property="og:title" content="项目规范化开发探索 - 常名斋">
  <meta property="og:description" content="前因
这次在fcc2018前端大会上，听到了余澈前辈的《开源项目维护》分享，深有收获.所以站在前人的肩膀上探索探索
痛点
现在前端项目开发，主要是由代码、依赖库、文档、changelog、测试文件等等几部分组成。但是由于前端开发的不规范，大..." />
  <meta property="og:type" content="articles">
  <meta property="og:url" content="https://conceal.name/post/xiang-mu-gui-fan-hua-kai-fa-tan-suo/" />
  <meta property="og:image" content="https://conceal.name/post-images/xiang-mu-gui-fan-hua-kai-fa-tan-suo.jpg">
  <meta property="og:image:height" content="630">
  <meta property="og:image:width" content="1200">
  <meta name="twitter:title" content="项目规范化开发探索 - 常名斋">
  <meta name="twitter:description" content="前因
这次在fcc2018前端大会上，听到了余澈前辈的《开源项目维护》分享，深有收获.所以站在前人的肩膀上探索探索
痛点
现在前端项目开发，主要是由代码、依赖库、文档、changelog、测试文件等等几部分组成。但是由于前端开发的不规范，大...">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://conceal.name/post/xiang-mu-gui-fan-hua-kai-fa-tan-suo/">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
 
  
    <link rel="stylesheet" href="https://conceal.name/media/css/prism-github.css">
  

  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://conceal.name" class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      常名斋
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-64 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          项目规范化开发探索
        </h1>
        
          <img src="https://conceal.name/post-images/xiang-mu-gui-fan-hua-kai-fa-tan-suo.jpg" alt="项目规范化开发探索" class="block w-full mb-8">
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">2018-11-12 · 8 min read</div>
          
            <a href="https://conceal.name/tag/re4eMjzigC/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              Program
            </a>
          
        </div>
        <div class="markdown mb-8" v-pre>
          <h2 id="前因">前因</h2>
<p>这次在fcc2018前端大会上，听到了余澈前辈的《开源项目维护》分享，深有收获.所以站在前人的肩膀上探索探索</p>
<h2 id="痛点">痛点</h2>
<p>现在前端项目开发，主要是由代码、依赖库、文档、changelog、测试文件等等几部分组成。但是由于前端开发的不规范，大部分创业公司开发都是不考虑文档以及changelog之类的部分的，只要代码跑通，就OK。同样的，注释什么的自然也是不会去写的，整个项目就显得十分的杂乱，后来人也难以接手。</p>
<h2 id="思路">思路</h2>
<p>其实文档、changelog之类的内容都具有一定的可预见性，遵循于一定的原则，由此可见，理论上是可以由代码来自动实现的。因此，主要的自动化处理方式便是使用jsdoc注释规则规范化注释，由此可以借助jsdoc之类的工具自动生成文档。其次，使用统一的eslint文件规范代码的风格，使用统一的prettier配置文件规范代码的样式，然后使用统一的commitlint文件规范并自动生成commit message，有了规范的commit message后，就可以使用工具提取相应的内容，自动生成changelog。由此而来，项目最繁琐的几个痛点便可以轻松简化到规范的注释以及规范的commit message两点，即可。</p>
<h2 id="husky">Husky</h2>
<p>自动规范化项目，最核心的一个工具便是husky，简单来说，husky提供了几个钩子，可以拦截到git的比如commit、push等等操作，然后在操作前，执行某些脚本，预处理被操作的对象。</p>
<ul>
<li>
<p>安装</p>
<pre><code>  npm install husky --save-dev
</code></pre>
</li>
<li>
<p>配置</p>
<p>在最新版中，hasky的配置不需要写在npm script中了，直接在package.json中添加一下字段即可。</p>
<pre><code>      {
      &quot;husky&quot;: {
          &quot;hooks&quot;: {
          &quot;pre-commit&quot;: &quot;npm run test&quot;,
          &quot;pre-push&quot;: &quot;npm run test&quot;,
          &quot;...&quot;: &quot;...&quot;
          }
      }
      }
</code></pre>
</li>
</ul>
<h2 id="lint-staged">Lint-staged</h2>
<p>Lint-staged是自动规范化项目第二重要的工具，主要功能为依次运行传入的命令数组，但是，约束命令的作用范围只会影响到git staged范围内的文件，即用git add 添加到待commit队列的文件，从而避免影响到其他文件，同时也能加快预处理脚本的速度。</p>
<ul>
<li>
<p>安装</p>
<pre><code>  npm install --save-dev lint-staged
</code></pre>
</li>
<li>
<p>配置</p>
<p>同样是直接在package.json文件中直接添加lint-staged的命令列表</p>
<pre><code>      &quot;lint-staged&quot;: {
      &quot;*.js&quot;: [&quot;eslint --fix&quot;, &quot;git add&quot;]
      }
</code></pre>
<p>然后，将lint-staged与husky整合:</p>
<pre><code>      &quot;husky&quot;: {
      &quot;hooks&quot;: {  
          &quot;pre-commit&quot;: &quot;lint-staged&quot;
      }
      }
</code></pre>
<p>这样，便做到了每次commit的时候自动eslint将要上传的文件，然后才commit，其他没有被add的文件不会被eslint处理。</p>
</li>
</ul>
<h2 id="prettier">Prettier</h2>
<p>有了以上条件后，我们便可以来添加我们的第一个预处理脚本Prettier。prettier是最出名的代码格式化工具之一。由于我们每个人的编程习惯不一样，有的人喜欢分号，有些人不喜欢分号，有些人四个空格缩进，有些人八个空格缩进。如果强制每个人编码习惯一样，总是让人比较难受，所以这里可以约定一个统一个代码风格配置文件，在提交的时候自动处理代码，将它们格式化为统一的风格，这样每个人写代码的时候可以按着自己的习惯写，最后提交的代码又是风格一致的，两全其美。</p>
<ul>
<li>
<p>安装</p>
<pre><code>  yarn global add prettier
</code></pre>
</li>
<li>
<p>配置</p>
</li>
</ul>
<p><a href="https://prettier.io/docs/en/configuration.html">https://prettier.io/docs/en/configuration.html</a></p>
<ul>
<li>
<p>整合到lint-staged</p>
<pre><code>  &quot;*.js&quot;: [
      &quot;prettier --config ./.prettierrc --write&quot;,
      &quot;git add&quot;
    ]
</code></pre>
</li>
</ul>
<h2 id="commit-message-规范">Commit-message 规范</h2>
<p>要从commit message中提取到有用的数据用来生成CHANGELOG，那么commit message就必须有一个相对固定的格式，同时这个格式能够基本覆盖到所有的comm操作类型。</p>
<p>目前比较流行的格式为<a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines">Angular Git Commit Guidelines</a></p>
<p>大致的格式如下:</p>
<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
&lt;BLANK LINE&gt;
&lt;body&gt;
&lt;BLANK LINE&gt;
&lt;footer&gt;
</code></pre>
<ul>
<li>&lt;type&gt;:本次commit的类型，比如新特性feat，bug修复fix等等</li>
<li>&lt;scope&gt;:本次操作波及的范围，可自定义</li>
<li>&lt;BLANK LINE&gt;:空行</li>
<li>&lt;body&gt;:可选，描述本次commit的动机等等，如需换行，在行尾添加&quot;|&quot;</li>
<li>&lt;footer&gt;:可选，描述如解决了某个issue，或者这次为breaking change，对应的upgrade的方法等等</li>
</ul>
<h2 id="commitizen">Commitizen</h2>
<p>由上可见，一个规范的commit message其实十分的麻烦，对于一个连注释都不写的公司来说，要求同事都这样规范的写commit message显然是不可能的。所以，我们需要工具，能够自动生成这样格式的commit message，所以有了工具commitizen。</p>
<ul>
<li>
<p>安装</p>
<pre><code>  npm install -g commitizen
</code></pre>
</li>
</ul>
<p>安装完成后，系统便会多出git cz命令，git cz能够完全的代替git commit命令，拥有其所有的参数，使用方法完全一样，同时也可以被husky所拦截到.</p>
<p>commitizen采用了询问的方式来获取对应的commit信息，大致页面如下:</p>
<p><a href="https://www.notion.so/57b80f3f75b741e3a54546c20ae5e8e7#740da08879544516a6e90da754cb9b4a"></a></p>
<h2 id="cz-conventional-changelog">cz-conventional-changelog</h2>
<p>有了格式化的commit message后，我们便可以用来自动生成changelog了，好在Commitizen有着配套的工具。</p>
<pre><code>commitizen init cz-conventional-changelog --save-dev --save-exact
</code></pre>
<p>使用commitizen初始化cz-conventional-changelog，他会作为一个adapter来解析对应的内容。由于commit message的规范其实有很多种，angular的规范只是很常用的规范之一，所以对于不同的规范需要不同的adapter才能解析出对应的数据，不过因为和commitizen整合，所以不需要考虑格式和adapter不匹配的问题，毕竟格式是有commitizen自动生成的。</p>
<h2 id="commitlint">Commitlint</h2>
<p>虽然有了自动生成工具，但是肯定还是有偷懒的小伙伴懒得去写，直接随便写个message就上传，这样的话就会破坏掉原有的格式（强迫症也会表示很难受啊喂），所以我们需要一个lint工具来替我们检测对应的commit message是不是一个合法的commit message。当然，这个工具也应该自动调用，在上传的时候自动检测。</p>
<ul>
<li>
<p>安装</p>
<pre><code>  npm install --save-dev @commitlint/config-conventional @commitlint/cli
</code></pre>
<p>安装conventional格式的lint以及对应的cli（commitlint也有其他格式的adapter，若使用的是其他规范，请参考<a href="https://github.com/marionebl/commitlint">官网</a>）</p>
</li>
<li>
<p>配置</p>
<pre><code>  echo &quot;module.exports = {extends: ['@commitlint/config-conventional']}&quot; &gt; commitlint.config.js
</code></pre>
<p>你要是不嫌麻烦，新建对应的文件，然后把内容拷进去效果也一样。</p>
</li>
<li>
<p>与husky整合</p>
<pre><code>  {
    &quot;husky&quot;: {
      &quot;hooks&quot;: {
        &quot;commit-msg&quot;: &quot;commitlint -E HUSKY_GIT_PARAMS&quot;
      }  
    }
  }
</code></pre>
<p>这样便可以做到在commit的时候自动检测commit message是否合法了</p>
</li>
</ul>
<h2 id="standard-version">standard-version</h2>
<p>有了对应的adapter，就可以提取commit-message的信息，从而生成changelog。我们可以使用Conventional Changelog来生成changelog，不过Conventional Changelog是生成changelog的基本库，它们更推荐使用基于它们来实现的库standard-version来进行CHANGELOG的生成：</p>
<p><a href="https://www.notion.so/57b80f3f75b741e3a54546c20ae5e8e7#5a6f6095097d46bdb2a2d63df422ed6d"></a></p>
<ul>
<li>
<p>安装</p>
<pre><code>  npm i --save-dev standard-version
</code></pre>
</li>
<li>
<p>在package中使用npm script整合standard-version</p>
<pre><code>  {
    &quot;scripts&quot;: {
      &quot;release&quot;: &quot;standard-version&quot;
    }
  }
</code></pre>
</li>
</ul>
<p>这样，我们每次到了需要发布一个新版本的时候，使用npm run release就可以生成上一个版本到现在的CHANGELOG，同时standard-version本身也可以用作项目的版本管理工具。</p>
<h2 id="jsdoc">JSDOC</h2>
<p>jsdoc是一个通过注释自动生成文档的工具，虽然jsdoc已经很久没有人维护了，很多新语法都不支持（连PR都没人去通过了，感觉凉凉了），不过jsdoc的注释语法却是注释生成文档的通用语法，而且和vscode等编辑器整合的非常好，简单的snippet便可以生成对应的注释，如果再加上document-this插件，就基本OK了，写注释十分轻松。不过现在注释生成文档的工具，要么很丑，要么就是很久没维护了，就很蛋疼emmmm，只能说将就着用一用。。。。</p>
<p>待续。。。。。</p>
<p>Link: <a href="https://www.notion.so/aj0k3r/57b80f3f75b741e3a54546c20ae5e8e7"></a></p>

        </div>
        <!-- Share to Twitter, Weibo, Telegram -->
        <div class="flex items-center">
          <div class="mr-4 flex items-center">
            <i class="ri-share-forward-line text-gray-500"></i>
          </div>
          <div class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTwitter">
            <i class="ri-twitter-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex" @click="shareToWeibo">
            <i class="ri-weibo-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTelegram">
            <i class="ri-telegram-line"></i>
          </div>
        </div>
      </div>

      

      
        <div id="vlaine-comment"></div>
      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  至大无外，至小无内。
</footer>
    </div>

    <!-- TOC Container -->
    <div class="fixed right-0 bottom-0 mb-16 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight" @click="showToc = true">
      <i class="ri-file-list-line"></i>
    </div>

    <div class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast" :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast" @click="showToc = false">
          <i class="ri-close-line text-lg"></i>
        </div>
      </div>
      <div class="post-toc-container">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%89%8D%E5%9B%A0">前因</a></li>
<li><a href="#%E7%97%9B%E7%82%B9">痛点</a></li>
<li><a href="#%E6%80%9D%E8%B7%AF">思路</a></li>
<li><a href="#husky">Husky</a></li>
<li><a href="#lint-staged">Lint-staged</a></li>
<li><a href="#prettier">Prettier</a></li>
<li><a href="#commit-message-%E8%A7%84%E8%8C%83">Commit-message 规范</a></li>
<li><a href="#commitizen">Commitizen</a></li>
<li><a href="#cz-conventional-changelog">cz-conventional-changelog</a></li>
<li><a href="#commitlint">Commitlint</a></li>
<li><a href="#standard-version">standard-version</a></li>
<li><a href="#jsdoc">JSDOC</a></li>
</ul>
</li>
</ul>

      </div>
    </div>

    <!-- Back to top -->
    <div class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200" @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-line"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://conceal.name/media/scripts/main.js"></script>
  
  <!-- Code Highlight -->
  
    <script src="https://conceal.name/media/prism.js"></script>
    <script>
      Prism.highlightAll()
    </script>
  

  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
  <script>
    //拿到预览框架，也就是上面的html代码
    var pswpElement = document.querySelectorAll('.pswp')[0];
    //定义图片数组变量
    var imgitems;
    /**
    * 用于显示预览界面
    * @param index 图片数组下标
    */
    function viewImg(index) {
      //其它选项这里不做过多阐述，详情见官网
      var pswpoptions = {
        index: parseInt(index, 10), // 开始幻灯片索引。0是第一张幻灯片。必须是整数，而不是字符串。
        bgOpacity: 0.7, // 背景透明度，0-1
        maxSpreadZoom: 3, // 缩放级别，不要太大
      };
      //初始化并打开PhotoSwipe，pswpElement对应上面预览框架，PhotoSwipeUI_Default为皮肤，imgitems为图片数组，pswpoptions为选项
      var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions);
      gallery.init()
    }
    /**
    * 用于添加图片点击事件
    * @param img 图片元素
    * @param index 所属下标（在imgitems中的位置）
    */
    function addImgClick(img, index) {
      img.onclick = function() {
        viewImg(index)
      }
    }
    /**
    * 轮询所有图片，获取src、width、height等数据，加入imgitems，并给图片元素添加事件
    * 最好在onload中执行该方法，本站因放在最底部，所以直接初始化
    * 异步加载图片可在图片元素创建完成后调用此方法
    */
    function initImg() {
      //重置图片数组
      imgitems = [];
      //查找class:markdown 下的所有img元素并遍历
      var imgs = document.querySelectorAll('.markdown img');
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //本站相册初始为loading图片，真实图片放在data-src
        var ds = img.getAttribute("data-src");
        //创建image对象，用于获取图片宽高
        var imgtemp = new Image();
        //判断是否存在data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds
        } else {
          imgtemp.src = img.src
        }
        //判断是否存在缓存
        if (imgtemp.complete) {
          var imgobj = {
            "src": imgtemp.src,
            "w": imgtemp.width,
            "h": imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          console.log('进来了2')
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function() {
            var imgobj = {
              "src": this.src,
              "w": this.width,
              "h": this.height,
            };
            //不要使用push，因为onload前后顺序会不同
            imgitems[this.index] = imgobj
            //添加点击事件
            addImgClick(this.img, this.index);
          }
        }
      }
    }
    //初始化
    initImg();
  </script>
  
    <script type="application/javascript" src="https://unpkg.com/valine"></script>
<script type="application/javascript">
  new Valine({
    el: '#vlaine-comment',
    appId: '0Bynv3317JdQzREKavwHXPcx-gzGzoHsz',
    appKey: 'KyTcUc0qVFiSvszv0l5Gc3ln',
    pageSize: 10,
    notify: true,
    avatar: 'mp',
    verify: true,
    placeholder: '来都来了，不妨评论一下',
    visitor: true,
    highlight: true,
    recordIP: false,
  })
</script>
  
  
</body>

</html>